(function(a){a.fn.extend({unglorify:function(){a("#blowupDetails").children().detach();a(".overlay").remove();a(".overlay #thumbs").remove();a(".backdrop").remove();a("html").removeClass("overflow")},glorify:function(b){function n(){a(".thumbholder #thumb"+(h+1)+" img").css("opacity","0.5");a(".thumbholder #thumb"+(i+1)+" img").css("opacity","1")}function m(){a("#blowupDetails").children().detach();a(".overlay").remove();a(".overlay #thumbs").remove();a(".backdrop").remove();a("html").removeClass("overflow")}function l(b){g=b*a("#thumbs .thumb").outerWidth(true);h=i;i=b}function k(){var c=a(".thumbholder #thumb"+(i+1)+" img").attr("src");a("#blowupDetails").children().detach();a("#blowupDetails").append(b[i]);var d=a(".imageholder .blowup img");d.css("width","auto");d.css("height","auto");d.unbind("load");d.attr("src",c).load(function(){a(".imageholder .blowup").css("margin-top",(a(".imageholder").height()-a(this).height())/2);d.show();a("#blowupDetails").show();a(window).resize()})}function j(){a(".thumbholder #thumb"+(h+1)+" img").css("opacity","0.5");var b=a(".imageholder .blowup img");a("#blowupDetails").hide();b.hide();a("#thumbs").animate({left:(a(".overlay .thumbholder").width()-a(".thumbholder #selection").width())/2-g+2},250,function(){a(".thumbholder #thumb"+(i+1)+" img").css("opacity","1");k()})}function f(b){a(".overlay .thumbholder").append("<div id='thumbs'></div>");a(".thumbholder #thumbs").css("height",a(".overlay .thumbholder").height());var e=1;for(e=1;e<=c;e++){var f="thumb"+e;var g=a(d[e-1]).find("*").andSelf().filter("img")[0];a(".thumbholder #thumbs").append("<div class='thumb' id='"+f+"'></div>");var h=a("<img/>");h.appendTo("#"+f);h.hide();h.css("opacity",.5);h.attr("src",g.src).load(function(){var b=a("#thumbs .thumb").width();var c=a("#thumbs .thumb").height();if(a(this).width()/a(this).height()*c<b)a(this).css("width",b);else a(this).css("height",c);a(this).css("margin-left",(b-a(this).width())/2);a(this).show()})}a("#thumbs .thumb").click(function(){l(a(this).attr("id").substring(5)-1);j()});a("#thumbs .thumb").css("height",a(".thumbholder #selection").height()-2);a("#thumbs .thumb").css("width",a(".thumbholder #selection").width()-2);a(".thumbholder #thumbs").css("left",(a(".overlay .thumbholder").width()-a("#thumbs .thumb").width())/2+1);a(".thumbholder #thumbs").css("width",c*a("#thumbs .thumb").outerWidth(true));l(b);n();k()}function e(b){a("html").addClass("overflow");a("body").append("<div class='backdrop'></div>");a("body").append("<div class='overlay'></div>");a(".overlay").click(function(){m()});a(".overlay").append("<div id='close'></div>");a(".overlay #close").click(function(){m()});a(".overlay").append("<div class='imageholder'></div>");a(".overlay .imageholder").append("<div class='blowup'></div>");a(".imageholder .blowup").append("<img/>");a(".imageholder .blowup").append("<div id='blowupDetails'/>");a(".overlay").append("<div class='thumbholder'></div>");a(".overlay .thumbholder").append("<div id='selection'></div>");f(b);a(".overlay").append("<div id='left'></div>");a(".overlay").append("<div id='right'></div>");a(".overlay #left").click(function(){if(i>0){l(i-1);j()}return false});a(".overlay #right").click(function(){if(i<c-1){l(i+1);j()}return false});a(".overlay .thumbholder, .imageholder .blowup").click(function(){return false});a(window).resize()}a(this).children().hover(function(){a(this).css("cursor","pointer")});var c=a(this).children().size();var d=a(this).children();a(this).children().unbind("click").click(function(){e(a(this).index())});var g;var h;var i;a(window).unbind("resize").resize(function(){var b=a(".overlay .thumbholder").height();var c=a(".overlay .thumbholder").width();var d=a(this).height()-b;a(".overlay .imageholder").css("height",a(this).height()-b);a(".overlay #left").css("top",d/2-a(".overlay #left").height()/2);a(".overlay #right").css("top",d/2-a(".overlay #right").height()/2);a(".thumbholder #selection").css("left",(c-a(".thumbholder #selection").width())/2);a(".thumbholder #thumbs").css("left",(a(".overlay .thumbholder").width()-a(".thumbholder #selection").width())/2-g+2);a(".imageholder .blowup").css("margin-top",(a(".imageholder").height()-a(".imageholder .blowup").height())/2);if(a(".blowup").height()+200>a(window).height()){a(".blowup img").css("width","auto");a(".blowup img").css("height",a(window).height()-200)}if(a(".blowup").width()+200>a(window).width()){a(".blowup img").css("height","auto");a(".blowup img").css("width",a(window).width()-200)}a(".imageholder .blowup").css("margin-top",(a(".imageholder").height()-a(".imageholder .blowup").height())/2)});a(document).unbind().keydown(function(b){var c=b.keyCode;switch(c){case 37:a(".overlay #left").click();break;case 39:a(".overlay #right").click();break;case 27:m();break;default:return true}return false})}})})(jQuery)